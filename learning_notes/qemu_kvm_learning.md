# qemu_kvm learning

# Chapter  1. Qemu与KVM概述

## 1.1 虚拟化简介

### 1.1.1 虚拟化思想

虚拟化的主要思想:通过分层将底层复杂的、难用的资源虚拟抽象成简单的、易用的资源,提供给上层使用.

```
wine项目:让为windows编写的程序运行在linux上;
cygwin项目:让为linux编写的程序运行在windows上.
```

### 1.1.2 虚拟化简介

#### 1.1.2.1 进程

进程有自己独立的进程地址空间以及独立的CPU和寄存器,执行程序员编写的指令,完成一定的任务.因此,进程可以看成是一个独立的虚拟机.

```
1.一个进程在执行指令、访问内存的时候并不会影响其他进程;
2.每个进程都认为自己拥有整个机器;
3.进程的指令都是可以直接运行在硬件CPU上.
```

#### 1.1.2.2 模拟器

模拟器可以将为一种硬件指令集(ISA:Instruction Set Architecture)编译的程序运行在另一种硬件指令集上.

```
比如:应用程序在源ISA(e.g. ARM)上被编译出来,在模拟器的帮助下,运行在不同的目标ISA(e.g. x86)上.
```

模拟器有两种实现方式:

```
1.通过解释来实现:对程序的源ISA指令一条一条进行分析,然后执行相应的目标ISA指令;
2.通过二进制翻译实现:将程序中所有的源ISA指令全部翻译成目标ISA上具有相同功能的指令,然后在目标ISA指令机器上执行.
```

典型的模拟器:Qemu(Quick Emulator)的用户态程序模拟、Bochs模拟器等.

#### 1.1.2.3 高级语言虚拟机

高级语言虚拟机通常会定义一种全新的虚拟ISA,并在其中定义新的指令集、数据操作、寄存器的使用等类似物理ISA中的规范.其翻译过程为:

```
高级语言虚拟机源程序--->编译器--->字节码(编译器将源程序编译为虚拟ISA构成的字节码)
--->windows/linux平台虚拟机--->windows/linux OS.
```

虚拟机:用于将虚拟ISA指令转换为物理ISA指令.

典型的高级语言虚拟机:JVM虚拟机、Python虚拟机等.

#### 1.1.2.4 系统虚拟机

系统虚拟机能够提供一个完整的系统环境.

```
1.能够运行多个用户的多个进程;
2.通过系统虚拟化技术,能够在单个的宿主机硬件平台上运行多个虚拟机,每个虚拟机有着完整的虚拟机硬件(e.g.虚拟的CPU、内存、外设的);
3.虚拟机之间能够实现完整的隔离.
```

VMM(Virtual Machine Monitor,虚拟监控器):管理全局物理资源的软件.

```
VMM之于虚拟机就如同OS之于进程,VMM利用时分复用或空分复用的方法将硬件资源在各个虚拟机之间进行分配.
```

典型的系统虚拟化解决方案:VMware Workstation、Qemu、VirtualBox和HyperV等.

### 1.1.3 系统虚拟化的历史

KVM(Kernel Virtual Machine):2006年以色列初创公司(Qumranet)利用Intel的硬件虚拟化技术在Linux内核上开发了KVM,RedHat后来收购了Qumranet.

```
KVM具有架构精简、与Linux天然融合的优点.现在是一个非常成功的虚拟化VMM,广泛应用于各种开源云平台上,成为云计算的基石.
```

系统虚拟化方案介绍:

```
1.VMware Workstation:有大量用户,用户可以非常方便的在PC上构建一个虚拟机,安装各种OS;
2.VirtualBox:最早由德国公司开发,后来被甲骨文收购.优点是性能不错、开源.但是不如VMware Workstation稳定;
3.HyperV:微软提供的虚拟化解决方案,微软用它来构建自己的云计算平台;
4.Xen:早期的开源虚拟化方案,出现在各种硬件虚拟化技术之前,其发展不如KVM.
```

